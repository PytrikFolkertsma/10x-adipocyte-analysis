---
title: "R Notebook"
output: html_notebook
---



```{r}
library(Seurat)
library(knitr)
library(ggplot2)
require(scales)
seurobj <- readRDS('output/seurat_objects/180831/10x-180831')
```

Calculate averages for clusters from resolution 1.5:

```{r, fig.height = 4, fig.width = 5, fig.align = "center"}
p <- TSNEPlot(seurobj, group.by='res.1.5', do.label=T, pt.size=0.1)
p
```

```{r, fig.height = 12, fig.width = 12, fig.align = "center"}
v1 <- VlnPlot(seurobj, features.plot='percent.mito', point.size.use=-1, group.by='res.1.5')
v1
```

```{r, fig.height = 4, fig.width = 12, fig.align = "center"}
v2 <- VlnPlot(seurobj, features.plot='percent.mito', point.size.use=-1, group.by='res.1.5', y.max=0.2)
v2
```


```{r}
save_plot(p, file='figures/figures_paper/supplementary_figures/batlas/10x-180831_tsne_res.1.5.pdf', base_width=5, base_height=4)
save_plot(v1, file='figures/figures_paper/supplementary_figures/batlas/10x-180831_vlnplot_percent.mito_clustering.1.5.pdf', base_width=12, base_height=10)
save_plot(v2, file='figures/figures_paper/supplementary_figures/batlas/10x-180831_vlnplot_percent.mito_clustering.1.5_y-cutoff-0.2.pdf', base_width=12, base_height=4)
```

```{r}
#Average expression is calculated by: (mean(1expm(seurobj@data[gene, cluster])))
#average.expression <- AverageExpression(SetAllIdent(seurobj, id='res.1.5'))
```

BATLAS results.

```{r}
batlas <- read.table('tables/tables_paper/supplementary_tables/BATLAS/BATLAS.txt', header=T, sep='\t')
batlas$cluster <- as.character(batlas$cluster)
kable(batlas)
```

```{r, fig.height = 6, fig.width = 12, fig.align = "center"}
p <- ggplot(data=batlas, aes(x=cluster, y=brown)) +
  geom_bar(stat="identity") +
  ylab('Brown percentage estimate') +
  coord_flip()
p
```

```{r}
save_plot('figures/figures_paper/supplementary_figures/batlas/BATLAS_results.pdf', p, base_height=6, base_width=12)
```

BATLAS results log normalized.

```{r}
batlas <- read.table('tables/tables_paper/supplementary_tables/BATLAS/BATLAS_log_normalized.txt', header=T, sep='\t')
batlas$cluster <- as.character(batlas$cluster)
kable(batlas)
```

```{r, fig.height = 6, fig.width = 12, fig.align = "center"}
p <- ggplot(data=batlas, aes(x=cluster, y=brown)) +
  geom_bar(stat="identity") +
  ylab('Brown percentage estimate') +
  coord_flip()
p
```

```{r}
save_plot('figures/figures_paper/supplementary_figures/batlas/BATLAS_results_log-normalized.pdf', p, base_height=6, base_width=12)
```


